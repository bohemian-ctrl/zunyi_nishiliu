(function(){"use strict";var e={9660:function(e,t,i){var s=i(6848),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},a=[],o=i(1656),n={},l=(0,o.A)(n,r,a,!1,null,null,null),c=l.exports,h=i(6178),d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("CesiumViewer")],1)},u=[],p=(i(8111),i(1701),function(){var e=this,t=e._self._c;return t("div",{staticClass:"cesium-container"},[t("div",{ref:"cesiumContainer",attrs:{id:"cesiumContainer"}}),t("div",{staticClass:"control-panel left-panel"},[e._m(0),t("div",{staticClass:"panel-section"},[t("h3",[e._v("预设视角")]),t("div",{staticClass:"button-group"},[t("button",{staticClass:"btn-primary",on:{click:function(t){return e.flyToView("overview")}}},[e._v("全市概览")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return e.flyToView("highRisk")}}},[e._v("高风险区聚焦")])])]),t("div",{staticClass:"panel-section"},[t("h3",[e._v("图层控制")]),t("div",{staticClass:"layer-control"},[t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.terrain,expression:"layers.terrain"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.layers.terrain)?e._i(e.layers.terrain,null)>-1:e.layers.terrain},on:{change:[function(t){var i=e.layers.terrain,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"terrain",i.concat([a])):o>-1&&e.$set(e.layers,"terrain",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"terrain",r)},function(t){return e.toggleLayer("terrain")}]}}),t("span",[e._v("地形")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.satellite,expression:"layers.satellite"}],attrs:{type:"checkbox",checked:""},domProps:{checked:Array.isArray(e.layers.satellite)?e._i(e.layers.satellite,null)>-1:e.layers.satellite},on:{change:[function(t){var i=e.layers.satellite,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"satellite",i.concat([a])):o>-1&&e.$set(e.layers,"satellite",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"satellite",r)},function(t){return e.toggleLayer("satellite")}]}}),t("span",[e._v("卫星底图")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.slope,expression:"layers.slope"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.layers.slope)?e._i(e.layers.slope,null)>-1:e.layers.slope},on:{change:[function(t){var i=e.layers.slope,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"slope",i.concat([a])):o>-1&&e.$set(e.layers,"slope",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"slope",r)},function(t){return e.toggleLayer("slope")}]}}),t("span",[e._v("坡度")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.ndvi,expression:"layers.ndvi"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.layers.ndvi)?e._i(e.layers.ndvi,null)>-1:e.layers.ndvi},on:{change:[function(t){var i=e.layers.ndvi,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"ndvi",i.concat([a])):o>-1&&e.$set(e.layers,"ndvi",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"ndvi",r)},function(t){return e.toggleLayer("ndvi")}]}}),t("span",[e._v("NDVI植被")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.precipitation,expression:"layers.precipitation"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.layers.precipitation)?e._i(e.layers.precipitation,null)>-1:e.layers.precipitation},on:{change:[function(t){var i=e.layers.precipitation,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"precipitation",i.concat([a])):o>-1&&e.$set(e.layers,"precipitation",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"precipitation",r)},function(t){return e.toggleLayer("precipitation")}]}}),t("span",[e._v("降水量")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.risk,expression:"layers.risk"}],attrs:{type:"checkbox",checked:""},domProps:{checked:Array.isArray(e.layers.risk)?e._i(e.layers.risk,null)>-1:e.layers.risk},on:{change:[function(t){var i=e.layers.risk,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"risk",i.concat([a])):o>-1&&e.$set(e.layers,"risk",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"risk",r)},function(t){return e.toggleLayer("risk")}]}}),t("span",[e._v("风险区")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.layers.buildings,expression:"layers.buildings"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.layers.buildings)?e._i(e.layers.buildings,null)>-1:e.layers.buildings},on:{change:[function(t){var i=e.layers.buildings,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.layers,"buildings",i.concat([a])):o>-1&&e.$set(e.layers,"buildings",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.layers,"buildings",r)},function(t){return e.toggleLayer("buildings")}]}}),t("span",[e._v("建筑")])])])]),e.layers.risk?t("div",{staticClass:"panel-section"},[t("h3",[e._v("风险区透明度")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.riskOpacity,expression:"riskOpacity",modifiers:{number:!0}}],staticClass:"slider",attrs:{type:"range",min:"0",max:"1",step:"0.1"},domProps:{value:e.riskOpacity},on:{input:e.updateRiskOpacity,__r:function(t){e.riskOpacity=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}}),t("span",{staticClass:"slider-value"},[e._v(e._s((100*Number(e.riskOpacity)).toFixed(0))+"%")])]):e._e(),e.layers.risk?t("div",{staticClass:"panel-section"},[t("h3",[e._v("风险等级")]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.riskLevels.high,expression:"riskLevels.high"}],attrs:{type:"checkbox",checked:""},domProps:{checked:Array.isArray(e.riskLevels.high)?e._i(e.riskLevels.high,null)>-1:e.riskLevels.high},on:{change:[function(t){var i=e.riskLevels.high,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.riskLevels,"high",i.concat([a])):o>-1&&e.$set(e.riskLevels,"high",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.riskLevels,"high",r)},e.updateRiskLevels]}}),t("span",{staticClass:"risk-high"},[e._v("高风险")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.riskLevels.medium,expression:"riskLevels.medium"}],attrs:{type:"checkbox",checked:""},domProps:{checked:Array.isArray(e.riskLevels.medium)?e._i(e.riskLevels.medium,null)>-1:e.riskLevels.medium},on:{change:[function(t){var i=e.riskLevels.medium,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.riskLevels,"medium",i.concat([a])):o>-1&&e.$set(e.riskLevels,"medium",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.riskLevels,"medium",r)},e.updateRiskLevels]}}),t("span",{staticClass:"risk-medium"},[e._v("中风险")])]),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.riskLevels.low,expression:"riskLevels.low"}],attrs:{type:"checkbox",checked:""},domProps:{checked:Array.isArray(e.riskLevels.low)?e._i(e.riskLevels.low,null)>-1:e.riskLevels.low},on:{change:[function(t){var i=e.riskLevels.low,s=t.target,r=!!s.checked;if(Array.isArray(i)){var a=null,o=e._i(i,a);s.checked?o<0&&e.$set(e.riskLevels,"low",i.concat([a])):o>-1&&e.$set(e.riskLevels,"low",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.riskLevels,"low",r)},e.updateRiskLevels]}}),t("span",{staticClass:"risk-low"},[e._v("低风险")])])]):e._e(),t("div",{staticClass:"panel-section"},[t("h3",[e._v("测量工具")]),t("div",{staticClass:"button-group"},[t("button",{staticClass:"btn-secondary",class:{"btn-active":"distance"===e.measureMode},on:{click:function(t){return e.startMeasure("distance")}}},[e._v("测距")]),t("button",{staticClass:"btn-secondary",class:{"btn-active":"area"===e.measureMode},on:{click:function(t){return e.startMeasure("area")}}},[e._v("测面积")]),t("button",{staticClass:"btn-secondary",class:{"btn-active":"profile"===e.measureMode},on:{click:function(t){return e.startMeasure("profile")}}},[e._v("剖面分析")]),t("button",{staticClass:"btn-secondary",on:{click:e.clearMeasure}},[e._v("清除")])])]),e.timeEnabled?t("div",{staticClass:"panel-section"},[t("h3",[e._v("时间轴")]),t("div",{staticClass:"time-control"},[t("button",{staticClass:"btn-secondary",on:{click:e.togglePlay}},[e._v(e._s(e.isPlaying?"暂停":"播放"))]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.timeValue,expression:"timeValue"}],staticClass:"slider",attrs:{type:"range",min:"0",max:"100"},domProps:{value:e.timeValue},on:{input:e.updateTime,__r:function(t){e.timeValue=t.target.value}}}),t("span",{staticClass:"time-display"},[e._v(e._s(e.formatTime(e.timeValue)))])]),t("div",{staticClass:"speed-control"},[t("label",[e._v("播放速度：")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.playSpeed,expression:"playSpeed"}],on:{change:[function(t){var i=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.playSpeed=t.target.multiple?i:i[0]},e.updatePlaySpeed]}},[t("option",{attrs:{value:"0.5"}},[e._v("0.5x")]),t("option",{attrs:{value:"1",selected:""}},[e._v("1x")]),t("option",{attrs:{value:"2"}},[e._v("2x")]),t("option",{attrs:{value:"5"}},[e._v("5x")])])])]):e._e()]),e.isLoading?t("div",{staticClass:"loading-overlay"},[t("div",{staticClass:"loading-content"},[t("div",{staticClass:"loading-spinner"}),t("h3",[e._v("正在加载数据...")]),t("p",{staticClass:"loading-message"},[e._v(e._s(e.loadMessage))]),t("div",{staticClass:"progress-bar-container"},[t("div",{staticClass:"progress-bar",style:{width:e.loadProgress+"%"}})]),t("p",{staticClass:"progress-text"},[e._v(e._s(e.loadedEntities)+" / "+e._s(e.totalEntities)+" 个区域已加载 ("+e._s(Math.round(e.loadProgress))+"%)")])])]):e._e(),e.isUpdatingOpacity?t("div",{staticClass:"loading-overlay"},[t("div",{staticClass:"loading-content"},[t("div",{staticClass:"loading-spinner"}),t("h3",[e._v("正在更新透明度...")]),t("p",{staticClass:"loading-message"},[e._v(e._s(e.updateOpacityMessage))]),t("div",{staticClass:"progress-bar-container"},[t("div",{staticClass:"progress-bar",style:{width:e.updateOpacityProgress+"%"}})]),t("p",{staticClass:"progress-text"},[e._v(e._s(Math.round(e.updateOpacityProgress))+"%")])])]):e._e(),e.selectedFeature?t("div",{staticClass:"info-panel right-panel"},[t("div",{staticClass:"panel-header"},[t("h3",[e._v("区域信息")]),t("button",{staticClass:"close-btn",on:{click:e.closeInfoPanel}},[e._v("×")])]),e.selectedEntities.length>1?t("div",{staticClass:"selected-count"},[e._v(" 已选中 "+e._s(e.selectedEntities.length)+" 个区域 ")]):e._e(),t("div",{staticClass:"info-content"},[t("div",{staticClass:"info-item"},[t("label",[e._v("风险等级：")]),t("span",{class:e.getRiskClass(e.selectedFeature.properties.riskLevel)},[e._v(" "+e._s(e.getRiskText(e.selectedFeature.properties.riskLevel))+" "),e.selectedFeature.properties.risk?t("span",{staticClass:"risk-code"},[e._v(" (Risk: "+e._s(e.selectedFeature.properties.risk)+") ")]):e._e()])]),e.selectedFeature.properties.count?t("div",{staticClass:"info-item"},[t("label",[e._v("区域数量：")]),t("span",[e._v(e._s(e.selectedFeature.properties.count))])]):e._e(),e.selectedFeature.properties.slope?t("div",{staticClass:"info-item"},[t("label",[e._v("坡度：")]),t("span",[e._v(e._s(e.selectedFeature.properties.slope)+"°")])]):e._e(),e.selectedFeature.properties.ndvi?t("div",{staticClass:"info-item"},[t("label",[e._v("NDVI：")]),t("span",[e._v(e._s(e.selectedFeature.properties.ndvi))])]):e._e(),e.selectedFeature.properties.precipitation?t("div",{staticClass:"info-item"},[t("label",[e._v("年降水量：")]),t("span",[e._v(e._s(e.selectedFeature.properties.precipitation)+"mm")])]):e._e(),e.selectedFeature.properties.township?t("div",{staticClass:"info-item"},[t("label",[e._v("所属乡镇：")]),t("span",[e._v(e._s(e.selectedFeature.properties.township))])]):e._e(),e.selectedFeature.properties.area?t("div",{staticClass:"info-item"},[t("label",[e._v("面积：")]),t("span",[e._v(e._s(e.selectedFeature.properties.area)+" km²")])]):e._e(),e.selectedEntities.length>0?t("div",{staticClass:"info-actions"},[t("button",{staticClass:"btn-export",on:{click:e.exportSelectedData}},[e._v("导出选中数据(CSV)")])]):e._e()])]):e._e(),e._m(1),e.measureResult?t("div",{staticClass:"measure-result"},[t("div",{staticClass:"result-content"},[t("h4",[e._v("测量结果")]),"distance"===e.measureResult.type?t("p",[e._v("距离："+e._s(e.measureResult.value)+" km")]):e._e(),"area"===e.measureResult.type?t("p",[e._v("面积："+e._s(e.measureResult.value)+" km²")]):e._e(),t("button",{staticClass:"btn-small",on:{click:e.clearMeasure}},[e._v("关闭")])])]):e._e()])}),v=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"panel-header"},[t("h2",[e._v("泥石流风险可视化")]),t("p",{staticClass:"subtitle"},[e._v("遵义市")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"legend"},[t("h4",[e._v("图例")]),t("div",{staticClass:"legend-item"},[t("span",{staticClass:"legend-color risk-high"}),t("span",[e._v("高风险区")])]),t("div",{staticClass:"legend-item"},[t("span",{staticClass:"legend-color risk-medium"}),t("span",[e._v("中风险区")])]),t("div",{staticClass:"legend-item"},[t("span",{staticClass:"legend-color risk-low"}),t("span",[e._v("低风险区")])]),t("div",{staticClass:"legend-item"},[t("span",{staticClass:"legend-color water"}),t("span",[e._v("水体")])])])}],g=(i(4114),i(2489),i(7588),i(3019)),m=g;const{Viewer:y,Cartesian3:k,Color:f,GeoJsonDataSource:w,ScreenSpaceEventHandler:L,ScreenSpaceEventType:C,Math:b,HeadingPitchRange:_,BoundingSphere:T,EllipsoidTerrainProvider:E,UrlTemplateImageryProvider:R,createWorldTerrain:A,createOsmBuildings:M}=g;class S{constructor(e){this.viewer=e,this.activeEntity=null,this.measureEntities=[],this.handler=null,this.positions=[],this.type=null}startDistanceMeasure(){this.clear(),this.type="distance",this.setupHandler(),this.handler.setInputAction(e=>{const t=this.viewer.camera.pickEllipsoid(e.position,this.viewer.scene.globe.ellipsoid);t&&(this.positions.push(t),this.updateDistanceMeasure())},m.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(e=>{if(this.positions.length>0){const t=this.viewer.camera.pickEllipsoid(e.endPosition,this.viewer.scene.globe.ellipsoid);t&&this.updateDistancePreview(t)}},m.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(()=>{this.finishMeasure()},m.ScreenSpaceEventType.RIGHT_CLICK)}startAreaMeasure(){this.clear(),this.type="area",this.setupHandler(),this.handler.setInputAction(e=>{const t=this.viewer.camera.pickEllipsoid(e.position,this.viewer.scene.globe.ellipsoid);t&&(this.positions.push(t),this.updateAreaMeasure())},m.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(e=>{if(this.positions.length>0){const t=this.viewer.camera.pickEllipsoid(e.endPosition,this.viewer.scene.globe.ellipsoid);t&&this.updateAreaPreview(t)}},m.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(()=>{this.finishMeasure()},m.ScreenSpaceEventType.RIGHT_CLICK)}startProfileMeasure(){this.clear(),this.type="profile",this.setupHandler(),this.handler.setInputAction(e=>{const t=this.viewer.camera.pickEllipsoid(e.position,this.viewer.scene.globe.ellipsoid);t&&(this.positions.push(t),1===this.positions.length?this.createProfileLine():2===this.positions.length&&(this.generateProfile(),this.finishMeasure()))},m.ScreenSpaceEventType.LEFT_CLICK)}setupHandler(){this.handler&&this.handler.destroy(),this.handler=new m.ScreenSpaceEventHandler(this.viewer.scene.canvas)}updateDistanceMeasure(){if(this.positions.length<2)return;this.activeEntity&&this.viewer.entities.remove(this.activeEntity),this.activeEntity=this.viewer.entities.add({polyline:{positions:this.positions,width:3,material:m.Color.YELLOW,clampToGround:!0}});let e=0;for(let s=0;s<this.positions.length-1;s++){const t=m.Cartesian3.distance(this.positions[s],this.positions[s+1]);e+=t}const t=this.positions[this.positions.length-1],i=(m.Cartographic.fromCartesian(t),this.viewer.entities.add({position:t,label:{text:`${(e/1e3).toFixed(2)} km`,font:"14px sans-serif",fillColor:m.Color.WHITE,outlineColor:m.Color.BLACK,outlineWidth:2,style:m.LabelStyle.FILL_AND_OUTLINE,verticalOrigin:m.VerticalOrigin.BOTTOM,pixelOffset:new m.Cartesian2(0,-20)}}));this.measureEntities.push(i)}updateDistancePreview(e){if(0===this.positions.length)return;const t=this.viewer.entities.getById("measure-preview");t&&this.viewer.entities.remove(t),this.viewer.entities.add({id:"measure-preview",polyline:{positions:[this.positions[this.positions.length-1],e],width:2,material:m.Color.YELLOW.withAlpha(.5),clampToGround:!0}})}updateAreaMeasure(){if(this.positions.length<3)return;this.activeEntity&&this.viewer.entities.remove(this.activeEntity);const e=[...this.positions,this.positions[0]];this.activeEntity=this.viewer.entities.add({polygon:{hierarchy:e,material:m.Color.BLUE.withAlpha(.3),outline:!0,outlineColor:m.Color.BLUE,outlineWidth:2}});const t=this.calculateArea(e),i=this.calculateCenter(e),s=this.viewer.entities.getById("area-label");s&&this.viewer.entities.remove(s),this.viewer.entities.add({id:"area-label",position:i,label:{text:`${(t/1e6).toFixed(2)} km²`,font:"14px sans-serif",fillColor:m.Color.WHITE,outlineColor:m.Color.BLACK,outlineWidth:2,style:m.LabelStyle.FILL_AND_OUTLINE}})}updateAreaPreview(e){if(0===this.positions.length)return;const t=this.viewer.entities.getById("area-preview");t&&this.viewer.entities.remove(t);const i=[...this.positions,e,this.positions[0]];this.viewer.entities.add({id:"area-preview",polygon:{hierarchy:i,material:m.Color.BLUE.withAlpha(.2),outline:!0,outlineColor:m.Color.BLUE.withAlpha(.5),outlineWidth:2}})}createProfileLine(){0!==this.positions.length&&(this.activeEntity=this.viewer.entities.add({polyline:{positions:this.positions,width:3,material:m.Color.CYAN,clampToGround:!0}}))}generateProfile(){if(this.positions.length<2)return;const e=this.positions[0],t=this.positions[1],i=100,s=[];for(let r=0;r<=i;r++){const a=r/i,o=m.Cartesian3.lerp(e,t,a,new m.Cartesian3),n=m.Cartographic.fromCartesian(o),l=this.viewer.scene.globe.getHeight(n)||0;s.push({distance:a*m.Cartesian3.distance(e,t),height:l,position:o})}return this.onProfileGenerated&&this.onProfileGenerated(s),s}calculateArea(e){if(e.length<3)return 0;let t=0;for(let s=0;s<e.length-1;s++){const i=m.Cartographic.fromCartesian(e[s]),r=m.Cartographic.fromCartesian(e[s+1]);t+=(r.longitude-i.longitude)*(r.latitude+i.latitude)}const i=6378137;return t=Math.abs(t)*i*i/2,t}calculateCenter(e){let t=0,i=0,s=0;for(let a=0;a<e.length-1;a++)t+=e[a].x,i+=e[a].y,s+=e[a].z;const r=e.length-1;return new m.Cartesian3(t/r,i/r,s/r)}finishMeasure(){this.handler&&(this.handler.destroy(),this.handler=null);const e=this.viewer.entities.getById("measure-preview");e&&this.viewer.entities.remove(e);const t=this.viewer.entities.getById("area-preview");t&&this.viewer.entities.remove(t);let i=null;if("distance"===this.type&&this.positions.length>=2){let e=0;for(let t=0;t<this.positions.length-1;t++)e+=m.Cartesian3.distance(this.positions[t],this.positions[t+1]);i={type:"distance",value:(e/1e3).toFixed(2),unit:"km"}}else if("area"===this.type&&this.positions.length>=3){const e=[...this.positions,this.positions[0]],t=this.calculateArea(e);i={type:"area",value:(t/1e6).toFixed(2),unit:"km²"}}return i}clear(){this.handler&&(this.handler.destroy(),this.handler=null),this.activeEntity&&(this.viewer.entities.remove(this.activeEntity),this.activeEntity=null),this.measureEntities.forEach(e=>{this.viewer.entities.remove(e)}),this.measureEntities=[];const e=this.viewer.entities.getById("measure-preview");e&&this.viewer.entities.remove(e);const t=this.viewer.entities.getById("area-preview");t&&this.viewer.entities.remove(t);const i=this.viewer.entities.getById("area-label");i&&this.viewer.entities.remove(i),this.positions=[],this.type=null}}i(4603),i(7566),i(8721);class x{constructor(e){this.viewer=e,this.dataSource=null,this.entities=[]}async loadFromGeoJSON(e,t,i){try{let s;if("string"===typeof e){console.log("正在从文件加载:",e),i&&i({progress:10,message:"正在下载数据文件...",total:0,loaded:0});const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);i&&i({progress:30,message:"正在解析数据...",total:0,loaded:0}),s=await t.json(),console.log("文件加载成功，特征数量:",s.features?.length||0)}else s=e;if(!s||!s.features||0===s.features.length)throw new Error("GeoJSON数据为空或格式不正确");this.dataSource=new m.GeoJsonDataSource("riskZones"),i&&i({progress:50,message:"正在加载到场景...",total:0,loaded:0}),await this.dataSource.load(s,{clampToGround:!0}),this.viewer.dataSources.add(this.dataSource),console.log("数据源已添加到Viewer，实体数量:",this.dataSource.entities.values.length);const r=this.dataSource.entities.values;this.entities=[];const a=50,o=10,n=r.length;console.log("开始处理",n,"个实体，分批大小:",a),i&&i({progress:60,message:`正在处理 ${n} 个区域...`,total:n,loaded:0});const l=this.viewer.scene.requestRenderMode,c=this.viewer.scene.maximumRenderTimeChange;this.viewer.scene.requestRenderMode=!0,this.viewer.scene.maximumRenderTimeChange=1/0;const h=e=>{if(!this.dataSource||!this.viewer)return void console.warn("数据源已销毁，停止处理");const d=Math.min(e+a,n);let u=e;for(let t=e;t<d;t++){const e=r[t];if(e&&e.polygon&&(this.styleRiskEntity(e,s.features[t]),this.entities.push(e)),i&&(t-u>=o||t===d-1)){const e=60+Math.floor((t+1)/n*35);i({progress:e,message:`正在处理区域 ${t+1} / ${n}...`,total:n,loaded:t+1}),u=t}}d<n?h(d):(this.viewer.scene.requestRenderMode=l,this.viewer.scene.maximumRenderTimeChange=c,this.viewer.scene.requestRender(),console.log("已样式化的实体数量:",this.entities.length,"处理完成"),i&&i({progress:100,message:"处理完成！",total:n,loaded:n}),t&&this.dataSource&&t(this.entities))};return h(0),this.entities}catch(s){throw console.error("加载风险区数据失败:",s),console.error("错误详情:",s.stack),s}}styleRiskEntity(e,t){const i=t.properties||{};let s="low";if(void 0!==i.Risk&&null!==i.Risk){const e=Number(i.Risk);1===e?s="high":2===e?s="medium":(3===e||console.warn("未知的 Risk 值:",i.Risk,"使用默认值 low"),s="low")}else s=i.riskLevel?i.riskLevel.toLowerCase():this.calculateRiskLevel(i);if(this.entities.length<5&&console.log("实体风险等级判断:",{Risk:i.Risk,riskLevel:s,props:i}),e.polygon.material=this.getRiskColor(s,.6),e.polygon.height=0,e.polygon.extrudedHeight=void 0,e.polygon.outline=!0,e.polygon.outlineColor=m.Color.WHITE.withAlpha(.8),e.polygon.outlineWidth=2,e.polygon.clampToGround=!0,e.polygon.classificationType=m.ClassificationType.TERRAIN,e.show=!0,e.properties||(e.properties={}),e.properties.setValue&&"function"===typeof e.properties.setValue){const r=e.properties.getValue?e.properties.getValue():{};e.properties.setValue({...r,riskLevel:s,risk:i.Risk||0,slope:i.slope||0,ndvi:i.ndvi||0,precipitation:i.precipitation||0,township:i.township||i.乡镇||"",area:i.area||this.calculateArea(t.geometry),count:i.count||0})}else e.properties={...e.properties,riskLevel:s,risk:i.Risk||0,slope:i.slope||0,ndvi:i.ndvi||0,precipitation:i.precipitation||0,township:i.township||i.乡镇||"",area:i.area||this.calculateArea(t.geometry),count:i.count||0};e._riskLevel=s,e._riskData={riskLevel:s,risk:i.Risk||0,slope:i.slope||0,ndvi:i.ndvi||0,precipitation:i.precipitation||0,township:i.township||i.乡镇||"",area:i.area||this.calculateArea(t.geometry),count:i.count||0}}calculateRiskLevel(e){const t=e.slope||0,i=e.ndvi||0,s=e.precipitation||0;return t>30&&i<.2&&s>800?"high":t>20||i<.3||s>600?"medium":"low"}getRiskColor(e,t=.6){const i="string"===typeof t?parseFloat(t):Number(t);if(isNaN(i))return console.warn("无效的透明度值:",t,"使用默认值 0.6"),this.getRiskColor(e,.6);const s=Math.max(0,Math.min(1,i)),r=String(e).toLowerCase().trim(),a={high:m.Color.RED.withAlpha(s),medium:m.Color.ORANGE.withAlpha(s),low:m.Color.YELLOW.withAlpha(s)},o=a[r];return o||(console.warn("未知的风险等级:",e,"原始值:",e,"标准化后:",r,"使用默认颜色 (low/yellow)"),a.low)}addWarningLabel(e,t){const i=this.getEntityCenter(e);if(!i)return;const s=this.viewer.entities.add({position:i,billboard:{image:this.createWarningIcon("high"),scale:1,verticalOrigin:m.VerticalOrigin.BOTTOM},label:{text:"高风险区",font:"12px sans-serif",fillColor:m.Color.RED,outlineColor:m.Color.WHITE,outlineWidth:2,style:m.LabelStyle.FILL_AND_OUTLINE,verticalOrigin:m.VerticalOrigin.BOTTOM,pixelOffset:new m.Cartesian2(0,-30)}});e.warningLabel=s}createWarningIcon(e){const t=document.createElement("canvas");t.width=32,t.height=32;const i=t.getContext("2d"),s={high:"#e74c3c",medium:"#f39c12",low:"#f1c40f"};return i.fillStyle=s[e]||s.high,i.beginPath(),i.arc(16,16,14,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 20px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("!",16,16),t.toDataURL()}getEntityCenter(e){if(e.polygon&&e.polygon.hierarchy){const t=e.polygon.hierarchy.getValue();if(t.positions&&t.positions.length>0){const e=t.positions;let i=0,s=0,r=0;return e.forEach(e=>{i+=e.x,s+=e.y,r+=e.z}),new m.Cartesian3(i/e.length,s/e.length,r/e.length)}}return null}calculateArea(e){return 0}updateOpacity(e,t){const i="string"===typeof e?parseFloat(e):Number(e);if(isNaN(i)||i<0||i>1)return void console.warn("无效的透明度值:",e);const s=Math.max(0,Math.min(1,i));console.log("更新透明度:",s,"类型:",typeof s,"实体数量:",this.entities.length);const r=this.entities.length,a=Math.max(1,Math.floor(r/100));this.entities.forEach((e,i)=>{if(!e||!e.polygon)return;let o=e._riskLevel;if(!o&&e._riskData&&(o=e._riskData.riskLevel),!o&&e.properties)if(e.properties.getValue&&"function"===typeof e.properties.getValue)try{const t=e.properties.getValue();o=t?.riskLevel,o||void 0===t?.Risk||(o=1===t.Risk?"high":2===t.Risk?"medium":"low")}catch(n){}else o=e.properties.riskLevel,o||void 0===e.properties.Risk||(o=1===e.properties.Risk?"high":2===e.properties.Risk?"medium":"low");o||(o="low");try{const t=this.getRiskColor(o,s);e.polygon.material=t}catch(n){console.warn(`更新实体 ${i} 透明度失败:`,n)}if(t&&(i%a===0||i===r-1)){const e=Math.floor((i+1)/r*100);t({progress:e,message:`正在更新 ${i+1} / ${r} 个区域...`})}}),this.viewer&&this.viewer.scene&&this.viewer.scene.requestRender(),t&&t({progress:100,message:"更新完成！"}),console.log("透明度更新完成")}updateRiskLevels(e){this.entities.forEach(t=>{if(!t)return;let i=t._riskLevel;if(!i&&t._riskData&&(i=t._riskData.riskLevel),!i&&t.properties)if(t.properties.getValue&&"function"===typeof t.properties.getValue)try{const e=t.properties.getValue();if(i=e?.riskLevel,!i&&void 0!==e?.Risk){const t=Number(e.Risk);i=1===t?"high":2===t?"medium":"low"}}catch(r){console.warn("获取实体属性失败:",r)}else if(i=t.properties.riskLevel,!i&&void 0!==t.properties.Risk){const e=Number(t.properties.Risk);i=1===e?"high":2===e?"medium":"low"}i||(i="low");const s="high"===i&&e.high||"medium"===i&&e.medium||"low"===i&&e.low;this.dataSource&&!1!==this.dataSource.show&&(t.show=s,t.warningLabel&&(t.warningLabel.show=s&&"high"===i))})}setVisible(e){this.dataSource&&(this.dataSource.show=e),this.entities.forEach(t=>{if(t&&(t.show=e,t.warningLabel)){const i=t._riskLevel||t._riskData&&t._riskData.riskLevel||"low";t.warningLabel.show=e&&"high"===i}})}exportToCSV(e){if(!e||0===e.length)return null;const t=["风险等级","坡度(°)","NDVI","年降水量(mm)","所属乡镇","面积(km²)"],i=e.map(e=>{let t=e._riskLevel,i=0,s=0,r=0,a="",o=0;if(e._riskData&&(t=t||e._riskData.riskLevel,i=e._riskData.slope||0,s=e._riskData.ndvi||0,r=e._riskData.precipitation||0,a=e._riskData.township||"",o=e._riskData.area||0),!t&&e.properties){let l={};if(e.properties.getValue&&"function"===typeof e.properties.getValue)try{l=e.properties.getValue()||{}}catch(n){}else l=e.properties||{};if(t=t||l.riskLevel,!t&&void 0!==l.Risk){const e=Number(l.Risk);t=1===e?"high":2===e?"medium":"low"}i=i||l.slope||0,s=s||l.ndvi||0,r=r||l.precipitation||0,a=a||l.township||"",o=o||l.area||0}return[t||"low",i,s,r,a,o]}),s=[t.join(","),...i.map(e=>e.join(","))].join("\n"),r=new Blob(["\ufeff"+s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(r),o=document.createElement("a");return o.href=a,o.download=`风险区数据_${(new Date).getTime()}.csv`,o.click(),URL.revokeObjectURL(a),s}clear(){if(this.entities.forEach(e=>{if(e.warningLabel){try{this.viewer.entities.remove(e.warningLabel)}catch(t){console.warn("清理标注失败:",t)}e.warningLabel=null}}),this.dataSource){try{this.viewer.dataSources.remove(this.dataSource)}catch(e){console.warn("清理数据源失败:",e)}this.dataSource=null}this.entities=[]}}const O=4343955;var D={name:"CesiumViewer",data(){return{viewer:null,measureTool:null,riskDataLoader:null,layers:{terrain:!0,satellite:!0,slope:!1,ndvi:!1,precipitation:!1,risk:!0,buildings:!1},riskOpacity:.6,riskLevels:{high:!0,medium:!0,low:!0},measureMode:null,measureResult:null,selectedFeature:null,slopeLayer:null,ndviLayer:null,precipitationLayer:null,buildingsLayer:null,timeEnabled:!1,isPlaying:!1,timeValue:0,playSpeed:1,selectedEntities:[],clickHandler:null,zoomTimeout:null,isLoading:!1,loadProgress:0,loadMessage:"",totalEntities:0,loadedEntities:0,isUpdatingOpacity:!1,updateOpacityProgress:0,updateOpacityMessage:"",zunyiBounds:{center:[106.9375,27.725],zoom:9}}},mounted(){this.initCesium()},beforeDestroy(){this.cleanup()},methods:{cleanup(){if(this.zoomTimeout&&(clearTimeout(this.zoomTimeout),this.zoomTimeout=null),this.clickHandler&&(this.clickHandler.destroy(),this.clickHandler=null),this.measureTool&&(this.measureTool.clear(),this.measureTool=null),this.riskDataLoader&&(this.riskDataLoader.clear(),this.riskDataLoader=null),this.buildingsLayer&&this.viewer){try{this.viewer.scene.primitives.remove(this.buildingsLayer)}catch(e){console.warn("清理建筑图层失败:",e)}this.buildingsLayer=null}if(this.viewer){try{this.viewer.destroy()}catch(e){console.warn("销毁Viewer失败:",e)}this.viewer=null}this.selectedEntities=[]},initCesium(){try{const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiOTA0NzFmOC1kYmNmLTQzMDctYjQxYS1iOTIwOWZhMTBmODkiLCJpZCI6Mzc1MTkwLCJpYXQiOjE3NjgyOTU3OTZ9.LSMLo60NHgkaMtgmxWSTGt_XYLpAp01StwJwMaiL8p4";m.Ion.defaultAccessToken=e}catch(e){console.warn("Cesium Ion token未设置，部分功能可能受限")}this.viewer=new m.Viewer("cesiumContainer",{imageryProvider:new m.UrlTemplateImageryProvider({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",credit:"Esri"}),timeline:!1,animation:!1,baseLayerPicker:!0,geocoder:!1,homeButton:!0,sceneModePicker:!1,navigationHelpButton:!1,terrainProvider:new m.EllipsoidTerrainProvider}),this.viewer.scene.globe.enableLighting=!1,this.viewer.scene.requestRenderMode=!0,this.viewer.scene.maximumRenderTimeChange=1/0,this.viewer.scene.primitives.maximumScreenSpaceError=2,this.viewer.scene.globe.depthTestAgainstTerrain=!1,this.viewer.scene.globe.tileCacheSize=100,this.measureTool=new S(this.viewer),this.riskDataLoader=new x(this.viewer),this.viewer.camera.setView({destination:m.Cartesian3.fromDegrees(this.zunyiBounds.center[0],this.zunyiBounds.center[1],5e4)}),this.loadTerrain(),this.setupClickHandler()},loadTerrain(){if(this.layers.terrain)try{const e=m.IonResource.fromAssetId(O),t=new m.CesiumTerrainProvider({url:e,requestVertexNormals:!0,requestWaterMask:!1});t.readyPromise.then(()=>{this.viewer.terrainProvider=t,console.log("遵义DEM地形加载中，Asset ID：",O),console.log("遵义DEM地形加载成功！");const e=document.querySelector(".cesium-widget-credits");e&&(e.style.display="none"),this.viewer.camera.flyTo({destination:m.Cartesian3.fromDegrees(106.9264,27.7259,1e4),orientation:{heading:m.Math.toRadians(0),pitch:m.Math.toRadians(-60),roll:0},duration:3}),setTimeout(()=>{this.loadRiskZones()},3e3)}).catch(e=>{console.error("DEM地形加载失败详情：",e),console.warn("使用默认地形作为备用方案"),this.viewer.terrainProvider=m.createWorldTerrain()})}catch(e){console.error("创建DEM地形提供者失败：",e),console.warn("使用默认地形作为备用方案"),this.viewer.terrainProvider=m.createWorldTerrain()}},async loadRiskZones(){try{this.isLoading=!0,this.loadProgress=0,this.loadMessage="正在读取数据文件...",this.totalEntities=0,this.loadedEntities=0,console.log("开始加载风险区数据: /data/doc.geojson");const e=await this.riskDataLoader.loadFromGeoJSON("/data/doc.geojson",e=>{this.viewer&&this.$el?(console.log("风险区数据加载成功，共",e.length,"个区域"),this.$nextTick(()=>{this.updateRiskOpacity(),this.updateRiskLevels()}),e.length>0&&this.viewer&&(this.zoomTimeout&&clearTimeout(this.zoomTimeout),this.zoomTimeout=setTimeout(()=>{if(this.viewer&&this.$el)try{this.viewer.zoomTo(this.riskDataLoader.dataSource),console.log("已自动缩放到数据范围")}catch(e){console.warn("自动缩放失败:",e)}},1e3))):console.warn("组件已销毁，取消数据加载回调")},e=>{console.log(e,this.isLoading),this.$el&&this.isLoading&&(this.loadProgress=e.progress||0,this.loadMessage=e.message||"正在加载...",this.totalEntities=e.total||0,this.loadedEntities=e.loaded||0,this.$forceUpdate(),e.loaded===e.total&&e.total>0&&setTimeout(()=>{this.$el&&(this.isLoading=!1,this.loadProgress=100,this.loadMessage="加载完成！")},300))});console.log("风险区实体列表:",e)}catch(e){this.isLoading=!1,this.loadMessage="加载失败！",console.error("加载风险区数据失败:",e),this.$el&&setTimeout(()=>{alert("加载风险区数据失败，请检查控制台错误信息")},500)}},getRiskColor(e){return this.riskDataLoader.getRiskColor(e,this.riskOpacity)},toggleLayer(e){switch(console.log("切换图层:",e,"状态:",this.layers[e]),e){case"terrain":this.layers.terrain?this.viewer.terrainProvider=m.createWorldTerrain():this.viewer.terrainProvider=new m.EllipsoidTerrainProvider;break;case"satellite":this.layers.satellite||console.log("卫星底图已关闭");break;case"risk":this.riskDataLoader&&(this.riskDataLoader.setVisible(this.layers.risk),console.log("风险区图层",this.layers.risk?"显示":"隐藏"));break;case"buildings":this.layers.buildings&&!this.buildingsLayer?this.loadBuildings():!this.layers.buildings&&this.buildingsLayer&&(this.viewer.scene.primitives.remove(this.buildingsLayer),this.buildingsLayer=null);break;case"slope":this.loadSlopeLayer();break;case"ndvi":this.loadNDVILayer();break;case"precipitation":this.loadPrecipitationLayer();break}},loadBuildings(){if(!this.buildingsLayer)try{this.buildingsLayer=this.viewer.scene.primitives.add(m.createOsmBuildings())}catch(e){console.warn("无法加载OSM Buildings:",e)}},loadSlopeLayer(){this.slopeLayer&&(this.viewer.imageryLayers.remove(this.slopeLayer),this.slopeLayer=null),this.layers.slope&&console.log("加载坡度图层")},loadNDVILayer(){this.ndviLayer&&(this.viewer.imageryLayers.remove(this.ndviLayer),this.ndviLayer=null),this.layers.ndvi&&console.log("加载NDVI图层")},loadPrecipitationLayer(){this.precipitationLayer&&(this.viewer.imageryLayers.remove(this.precipitationLayer),this.precipitationLayer=null),this.layers.precipitation&&console.log("加载降水量图层")},updateRiskOpacity(){const e="string"===typeof this.riskOpacity?parseFloat(this.riskOpacity):Number(this.riskOpacity);isNaN(e)||e<0||e>1?console.warn("无效的透明度值:",this.riskOpacity):(console.log("调用 updateRiskOpacity, 透明度值:",e,"类型:",typeof e),this.riskDataLoader&&this.riskDataLoader.entities&&this.riskDataLoader.entities.length>0?(this.isUpdatingOpacity=!0,this.updateOpacityProgress=0,this.updateOpacityMessage="正在更新风险区域透明度...",this.riskDataLoader.updateOpacity(e,e=>{this.$el&&(this.updateOpacityProgress=e.progress||0,this.updateOpacityMessage=e.message||"正在更新...",e.progress>=100&&setTimeout(()=>{this.$el&&(this.isUpdatingOpacity=!1,this.updateOpacityProgress=0,this.updateOpacityMessage="")},300))})):console.warn("风险数据加载器未初始化或没有实体"))},updateRiskLevels(){this.riskDataLoader&&this.riskDataLoader.updateRiskLevels(this.riskLevels)},setupClickHandler(){this.clickHandler&&this.clickHandler.destroy(),this.clickHandler=new m.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.clickHandler.setInputAction(e=>{if(this.viewer&&this.$el&&!this.measureMode)try{const t=this.viewer.scene.pick(e.position);if(m.defined(t)&&t.id){const e=t.id,i=this.riskDataLoader?.entities||[];if(i.includes(e)){const t=e.properties||{};this.selectedFeature={properties:{riskLevel:t.riskLevel||"low",risk:t.risk||0,slope:t.slope||0,ndvi:t.ndvi||0,precipitation:t.precipitation||0,township:t.township||"",area:t.area||0,count:t.count||0}},this.selectedEntities.includes(e)||this.selectedEntities.push(e)}}else this.selectedFeature=null}catch(t){console.warn("点击事件处理错误:",t)}},m.ScreenSpaceEventType.LEFT_CLICK),this.clickHandler.setInputAction(()=>{this.viewer&&this.$el&&(this.selectedFeature=null,this.selectedEntities=[])},m.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},flyToView(e){if("highRisk"===e)return void this.flyToHighRiskAreas();const t={overview:{destination:m.Cartesian3.fromDegrees(106.9375,27.725,1e4),orientation:{heading:m.Math.toRadians(0),pitch:m.Math.toRadians(-60),roll:0}},typical:{destination:m.Cartesian3.fromDegrees(107.05,27.65,15e3),orientation:{heading:m.Math.toRadians(45),pitch:m.Math.toRadians(-60),roll:0}}};t[e]&&this.viewer.camera.flyTo(t[e])},flyToHighRiskAreas(){if(!this.riskDataLoader||!this.riskDataLoader.dataSource)return console.warn("风险区数据未加载，无法聚焦高风险区域"),void this.viewer.camera.flyTo({destination:m.Cartesian3.fromDegrees(106.95,27.75,2e4),orientation:{heading:m.Math.toRadians(0),pitch:m.Math.toRadians(-20),roll:0}});const e=this.riskDataLoader?.entities||[];console.log("所有风险实体:",e.length);const t=e.filter(e=>{if(!e)return!1;if("high"===e._riskLevel)return!0;if(e._riskData&&"high"===e._riskData.riskLevel)return!0;let t=null;if(e.properties)if(e.properties.getValue&&"function"===typeof e.properties.getValue)try{const i=e.properties.getValue();t=i?.riskLevel,t||void 0===i?.Risk||(t=1===i.Risk?"high":2===i.Risk?"medium":"low")}catch(i){}else t=e.properties.riskLevel,t||void 0===e.properties.Risk||(t=1===e.properties.Risk?"high":2===e.properties.Risk?"medium":"low");return"high"===t});if(console.log("筛选结果 - 高风险实体数量:",t.length),t.length>0&&console.log("第一个高风险实体的属性:",{_riskLevel:t[0]._riskLevel,_riskData:t[0]._riskData,properties:t[0].properties}),0===t.length){console.warn("未找到高风险区域，缩放到所有数据范围");try{this.viewer.zoomTo(this.riskDataLoader.dataSource)}catch(s){console.warn("缩放失败:",s)}return}console.log("找到",t.length,"个高风险区域，正在聚焦...");const i=this.calculateBoundingSphere(t);if(i)this.viewer.camera.flyTo({destination:i.center,orientation:{heading:m.Math.toRadians(0),pitch:m.Math.toRadians(-60),roll:0},complete:()=>{const e=i.radius,t=3*e,s=m.Cartographic.fromCartesian(i.center);m.Cartesian3.fromRadians(s.longitude,s.latitude,t);this.viewer.zoomTo(this.riskDataLoader.dataSource)}});else{console.warn("计算边界失败，使用所有数据范围");try{this.viewer.zoomTo(this.riskDataLoader.dataSource)}catch(s){console.warn("缩放失败:",s)}}},calculateBoundingSphere(e){if(!e||0===e.length)return null;try{const t=[];if(e.forEach(e=>{if(e.polygon&&e.polygon.hierarchy){const i=e.polygon.hierarchy.getValue();i.positions&&i.positions.length>0&&i.positions.forEach(e=>{t.push(e)})}}),0===t.length)return null;const i=m.BoundingSphere.fromPoints(t);return i}catch(t){return console.warn("计算边界球失败:",t),null}},startMeasure(e){this.measureMode&&this.clearMeasure(),this.measureMode=e,this.measureResult=null,"distance"===e?this.measureTool.startDistanceMeasure():"area"===e?this.measureTool.startAreaMeasure():"profile"===e&&this.measureTool.startProfileMeasure()},clearMeasure(){if(this.measureTool){const e=this.measureTool.finishMeasure();e&&(this.measureResult=e),this.measureTool.clear()}this.measureMode=null,setTimeout(()=>{this.$el&&(this.measureResult=null)},3e3)},showProfileChart(e){console.log("剖面数据:",e),this.measureResult={type:"profile",value:`${e.length}个采样点`,data:e}},closeInfoPanel(){this.selectedFeature=null,this.selectedEntities=[]},exportSelectedData(){this.selectedEntities.length>0&&this.riskDataLoader&&this.riskDataLoader.exportToCSV(this.selectedEntities)},getRiskClass(e){return`risk-${e}`},getRiskText(e){const t={high:"高风险",medium:"中风险",low:"低风险"};return t[e]||"未知"},togglePlay(){this.isPlaying=!this.isPlaying},updateTime(){},formatTime(e){return`${e}天`},updatePlaySpeed(){}}},P=D,I=(0,o.A)(P,p,v,!1,null,"6b37f102",null),$=I.exports,V={name:"HomeView",components:{CesiumViewer:$}},N=V,F=(0,o.A)(N,d,u,!1,null,"70ae1ff4",null),B=F.exports;s.Ay.use(h.Ay);const H=[{path:"/",name:"home",component:B},{path:"/about",name:"about",component:()=>i.e(594).then(i.bind(i,6053))}],U=new h.Ay({mode:"history",base:"/",routes:H});var W=U,j=i(3518);s.Ay.use(j.Ay);var z=new j.Ay.Store({state:{},getters:{},mutations:{},actions:{},modules:{}});s.Ay.config.productionTip=!1,new s.Ay({router:W,store:z,render:e=>e(c)}).$mount("#app")}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,s,r,a){if(!s){var o=1/0;for(h=0;h<e.length;h++){s=e[h][0],r=e[h][1],a=e[h][2];for(var n=!0,l=0;l<s.length;l++)(!1&a||o>=a)&&Object.keys(i.O).every(function(e){return i.O[e](s[l])})?s.splice(l--,1):(n=!1,a<o&&(o=a));if(n){e.splice(h--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,r,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce(function(t,s){return i.f[s](e,t),t},[]))}}(),function(){i.u=function(e){return"js/about.c43cddb6.js"}}(),function(){i.miniCssF=function(e){}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="test2:";i.l=function(s,r,a,o){if(e[s])e[s].push(r);else{var n,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==t+a){n=d;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",i.nc&&n.setAttribute("nonce",i.nc),n.setAttribute("data-webpack",t+a),n.src=s),e[s]=[r];var u=function(t,i){n.onerror=n.onload=null,clearTimeout(p);var r=e[s];if(delete e[s],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach(function(e){return e(i)}),t)return t(i)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),l&&document.head.appendChild(n)}}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/"}(),function(){var e={524:0};i.f.j=function(t,s){var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)s.push(r[2]);else{var a=new Promise(function(i,s){r=e[t]=[i,s]});s.push(r[2]=a);var o=i.p+i.u(t),n=new Error,l=function(s){if(i.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var a=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;n.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",n.name="ChunkLoadError",n.type=a,n.request=o,r[1](n)}};i.l(o,l,"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,a,o=s[0],n=s[1],l=s[2],c=0;if(o.some(function(t){return 0!==e[t]})){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(l)var h=l(i)}for(t&&t(s);c<o.length;c++)a=o[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(h)},s=self["webpackChunktest2"]=self["webpackChunktest2"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=i.O(void 0,[929,121],function(){return i(9660)});s=i.O(s)})();
//# sourceMappingURL=app.c89b1e35.js.map